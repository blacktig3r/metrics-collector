# Node Metrics Collector

## Overview

This project collects system-level metrics from Kubernetes nodes by leveraging Prometheus Node Exporter and storing the collected metrics in a persistent volume. The key components are:

1. **Node Exporter** running as a DaemonSet on Kubernetes nodes to expose system metrics.
2. **Metrics Collector** which runs as a Kubernetes CronJob to fetch metrics from Node Exporter and store them in persistent storage using a Persistent Volume Claim (PVC).
3. **Inspect Volume Pod** to check the metrics files stored in the volume.
   
The collected data is stored in a PVC to ensure persistence, even in case of pod restarts. The cron job runs periodically, pulling metrics and saving them in timestamped log files.

## Project Structure

```plaintext
./
├── Dockerfile
├── fetch_metrics.sh
├── helm-charts
│   ├── Chart.yaml
│   ├── templates
│   │   ├── cronjob.yaml
│   │   └── pvc.yaml
│   └── values.yaml
└── manifest
    ├── inspect-volume-pod.yaml
    └── node-exporter-daemonset.yaml
```

## Docker Container

The cron job is containerized using the provided Dockerfile. The image is built with the necessary Bash script (fetch_metrics.sh) and pushed to Google Container Registry (GCR) or any other container registry.

#Build the Docker image:

```plaintext
docker build -t gcr.io/<your-project-id>/metrics-collector:latest .
```

#Push the image to GCR:

```plaintext
docker push gcr.io/<your-project-id>/metrics-collector:latest
```

## Deployment

**Step 1:** Deploy Node Exporter

The first step is to deploy Node Exporter using the provided manifest file. This will run Node Exporter as a DaemonSet on all Kubernetes nodes and expose metrics via a service.

```plaintext
kubectl apply -f manifest/node-exporter-daemonset.yaml
```

**Step 2: Deploy the Metrics Collector CronJob using Helm**

Next, you will deploy the Metrics Collector cron job using Helm charts. This cron job periodically scrapes metrics from Node Exporter and stores them in a PVC.

Update the values in helm-charts/values.yaml if needed.
Install the Helm chart:

```plaintext
helm install metrics-collector ./helm-charts
```

This will create a cron job in the cluster that runs the fetch_metrics.sh script at the interval defined in the Helm values. The cron job uses the PVC to store the collected metrics.

**Step 3: Inspect the Collected Data**

To verify that the collected data is saved correctly in the PVC, you can create a pod to inspect the contents of the volume.

```plaintext
kubectl apply -f manifest/inspect-volume-pod.yaml
```

After the pod is running, you can log in and check the files:

```plaintext
kubectl exec -it inspect-metrics -- sh
cd /metrics
ls -l
```

This will list the log files generated by the cron job. Each file will have a timestamp as part of its name, e.g., node_metrics_20231024_120000.log.
